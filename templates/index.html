<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI CV Processor - By Vansh Sabharwal</title>
<style>
/* --- Your Original Styles --- /
.centered-div {
background-color: antiquewhite;
width: 80%;
margin: 0 auto;
padding: 20px;
border-radius: 3%;
max-width: 800px; / Added max-width for larger screens /
}
body {
font-family: Arial, sans-serif;
line-height: 1.6;
margin: 0;
padding: 0;
background-color: #f4f4f4;
}
.container {
width: 80%;
margin: 0 auto;
padding: 20px;
background-color: white;
border-radius: 10px;
box-shadow: 0 4px 12px rgba(0,0,0,0.05);
max-width: 800px; / Added max-width /
}
.header, .section {
text-align: center;
margin-bottom: 40px;
}
.section h2 {
font-size: 1.5em;
}
.section p {
font-size: 1em;
}
.features {
display: flex;
flex-wrap: wrap;
justify-content: center;
margin-top: 20px;
}
.features div {
margin: 10px 15px;
}
.features p {
display: inline;
font-size: 1em;
}
.green-check {
color: green;
font-size: 20px;
font-weight: bold;
}
.upload-btn {
margin-top: 15px;
padding: 10px 25px;
font-size: 16px;
font-weight: bold;
color: white;
background-color: #007bff;
border: none;
border-radius: 5px;
cursor: pointer;
transition: background-color 0.2s;
}
.upload-btn:hover {
background-color: #0056b3;
}
/ Disable button when loading /
.upload-btn:disabled {
background-color: #aaa;
cursor: not-allowed;
}
.file-input {
font-size: 16px;
}
.error-message {
margin-top: 15px;
padding: 10px;
background-color: #ffe0e0;
border: 1px solid #c00;
color: #c00;
border-radius: 5px;
display: none; / Hide by default */
}

/* --- New Loader Modal Styles --- */
.loader-modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1000; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto; /* Enable scroll if needed */
    background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
}
.loader-content {
    background-color: #fefefe;
    color: #333;
    margin: 15% auto; /* 15% from the top and centered */
    padding: 30px;
    border: 1px solid #888;
    width: 80%;
    max-width: 500px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}
.progress-bar-container {
    width: 100%;
    background-color: #e0e0e0;
    border-radius: 5px;
    margin-top: 20px;
}
.progress-bar {
    width: 0%; /* Start at 0 */
    height: 20px;
    background-color: #007bff;
    border-radius: 5px;
    text-align: center;
    line-height: 20px;
    color: white;
    font-size: 12px;
    font-weight: bold;
    transition: width 0.5s ease-in-out; /* Smooth animation */
}
#status-text {
    font-size: 1.1em;
    font-weight: bold;
    margin-top: 15px;
}


</style>
</head>
<body>
<h1 style="text-align: center; margin-top: 20px;">AI CV Processor - Converts Resumes Into Clean And Sorted Excel Sheets</h1>

<div class="centered-div">
<h2 style="text-align: center;">Upload Your Resumes</h2>

<!-- Updated Form: Added id="upload-form" -->
<form style="text-align: center;" id="upload-form" action="/" method="post" enctype="multipart/form-data">
    <input type="file" name="file" id="file-input" accept=".pdf,.docx" class="file-input" multiple required><br>
    <button type="submit" id="upload-button" class="upload-btn">Upload and Process</button>
</form>

<!-- Error message display block -->
<div id="error-message-box" class="error-message">
    <p><strong>Error:</strong> <span id="error-text"></span></p>
</div>


</div>

<!-- The rest of your page content -->

<div class="container" style="margin-top: 40px;">
<div class="header">
<h1>Easily Convert Resumes into Smart, Editable Excel Sheets</h1>
<p>Our tool, now powered by AI, doesn't just convert your resumes; it understands them. It intelligently extracts key information like skills, experience, and education into a perfectly sorted Excel file, saving you hours of manual data entry. Simplify your recruitment with our powerful AI tool and increase your productivity.</p>
</div>
<!-- ... other sections ... -->
</div>

<footer style="text-align: center; padding: 20px;"><p>&#169; Vansh Sabharwal 2024</p></footer>

<!-- --- New Loader Modal HTML --- -->

<div id="loader-modal" class="loader-modal">
<div class="loader-content">
<h2>Processing Your Resumes...</h2>
<p>This may take a moment, especially with many files.</p>
<p id="status-text">Starting up...</p>
<div class="progress-bar-container">
<div id="progress-bar" class="progress-bar">0%</div>
</div>
</div>
</div>

<!-- --- New JavaScript Logic --- -->

<script>
// Get all the elements we need
const form = document.getElementById('upload-form');
const modal = document.getElementById('loader-modal');
const statusText = document.getElementById('status-text');
const progressBar = document.getElementById('progress-bar');
const uploadButton = document.getElementById('upload-button');
const errorBox = document.getElementById('error-message-box');
const errorText = document.getElementById('error-text');

// Listen for the form submission
form.addEventListener(&#39;submit&#39;, async function(event) {
    // Stop the default page reload
    event.preventDefault(); 
    
    // Show the modal and reset states
    modal.style.display = &#39;block&#39;;
    uploadButton.disabled = true;
    errorBox.style.display = &#39;none&#39;;
    updateProgress(0, &#39;Initializing...&#39;);

    try {
        // Step 1: Uploading
        updateProgress(10, &#39;Uploading files...&#39;);
        
        // Get the form data
        const formData = new FormData(form);

        // Use &#39;fetch&#39; to send the data in the background
        // This is the key part that avoids the browser timeout
        const response = await fetch(&#39;/&#39;, {
            method: &#39;POST&#39;,
            body: formData
        });

        // Step 2: Server is Processing
        // We fake this progress while the server works
        updateProgress(50, &#39;Server is processing... (This is the long step)&#39;);

        // Check if the server had an error (like a 500 crash)
        if (!response.ok) {
            let serverError = `Server error: ${response.status} ${response.statusText}`;
            try {
                // Try to get a more specific error message from the server
                const errorData = await response.json(); // Assuming server sends JSON on error
                serverError = errorData.error || serverError;
            } catch (e) {
                // Server didn&#39;t send JSON error, use default
            }
            throw new Error(serverError);
        }

        // Step 3: Almost Ready (Server is sending the file)
        updateProgress(90, &#39;Generating your Excel file...&#39;);
        
        // Get the file (blob) from the response
        const blob = await response.blob();
        
        // Check if the returned file is actually an Excel file
        // If the server had an error, it might send HTML/text instead
        if (blob.type !== &#39;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#39;) {
            // Try to read the blob as text to get the error message
            let errorMsg = &#39;Server did not return an Excel file. Check server logs.&#39;;
            try {
                const errText = await blob.text();
                const errJson = JSON.parse(errText);
                if (errJson.error) {
                    errorMsg = errJson.error;
                }
            } catch(e) {}
            throw new Error(errorMsg);
        }

        // Create a temporary URL for the file
        const url = window.URL.createObjectURL(blob);
        
        // Create a temporary link element to trigger the download
        const a = document.createElement(&#39;a&#39;);
        a.style.display = &#39;none&#39;;
        a.href = url;
        // Get filename from response header, or use a default
        const disposition = response.headers.get(&#39;content-disposition&#39;);
        let filename = &#39;AI_Resumes_Extract.xlsx&#39;;
        if (disposition &amp;&amp; disposition.indexOf(&#39;attachment&#39;) !== -1) {
            const filenameRegex = /filename[^;=\n]*=(([&#39;&quot;]).*?\2|[^;\n]*)/;
            const matches = filenameRegex.exec(disposition);
            if (matches != null &amp;&amp; matches[1]) {
                filename = matches[1].replace(/[&#39;&quot;]/g, &#39;&#39;);
            }
        }
        a.download = filename;
        
        document.body.appendChild(a);
        a.click(); // &quot;Click&quot; the link
        
        // Clean up
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);

        // Step 4: Done!
        updateProgress(100, &#39;Download complete!&#39;);
        
        setTimeout(() =&gt; {
            modal.style.display = &#39;none&#39;;
        }, 1000); // Hide modal after 1 second

    } catch (error) {
        console.error(&#39;Upload failed:&#39;, error);
        // Show the error in our error box
        errorText.textContent = error.message;
        errorBox.style.display = &#39;block&#39;;
        modal.style.display = &#39;none&#39;;
    } finally {
        // Re-enable the button whether it succeeded or failed
        uploadButton.disabled = false;
    }
});

function updateProgress(percent, text) {
    progressBar.style.width = percent + &#39;%&#39;;
    progressBar.textContent = percent + &#39;%&#39;;
    statusText.textContent = text;
}


</script>

</body>
</html>